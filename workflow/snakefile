# workflow/snakefile

# Project wide configuration
configfile: "config/config.yaml"

# Local rules
localrules:

# Other rules
include: "rules/preprocessing.smk"
include: "rules/annotation.smk"
include: "rules/reconstruction.smk"
include: "rules/modelProcessing.smk"

# Master rule to produce all the final output files
rule all:
    input:
        # Growth data preprocessing
        "results/preprocessing/growth-data/plate-reader/growth-data.tsv",
        "results/preprocessing/growth-data/summary/growth_easylinear.csv",
        "results/preprocessing/growth-data/summary/growth_binary.csv",
        "results/preprocessing/growth-data/summary/growth_heatmap.png",
        # Annotation using Bakta
        expand("results/annotation/{sample}/{sample}.gff3", sample=list(config["samples"].keys())),
        # Genome-scale metabolic model reconstruction using KEGG
        expand("results/reconstruction/draft/{sample}/{sample}_draft.mat", sample=list(config["samples"].keys())),
        expand("results/reconstruction/draft_spontaneous/{sample}/{sample}_draft_spontaneous.mat", sample=list(config["samples"].keys())),
        expand("results/reconstruction/relaxed/{sample}/{sample}_relaxed.mat", sample=list(config["samples"].keys())),
        expand("results/reconstruction/relaxed_spontaneous/{sample}/{sample}_relaxed_spontaneous.mat", sample=list(config["samples"].keys())),
        "results/reconstruction/summary/draft_metrics.csv",
        "results/reconstruction/summary/draft_spontaneous_metrics.csv",
        "results/reconstruction/summary/relaxed_metrics.csv",
        "results/reconstruction/summary/relaxed_spontaneous_metrics.csv",
        "results/reconstruction/summary/draft_statistics.md",
        "results/reconstruction/summary/draft_spontaneous_statistics.md",
        "results/reconstruction/summary/relaxed_statistics.md",
        "results/reconstruction/summary/relaxed_spontaneous_statistics.md",
        # ───────────────────────────────────────────────
        # PREPROCESSED MODELS
        # ───────────────────────────────────────────────
        expand("results/modelProcessing/draft/{sample}/{sample}_draft_preprocessed.mat",
            sample=config["samples"].keys()),

        expand("results/modelProcessing/draft_spontaneous/{sample}/{sample}_draft_spontaneous_preprocessed.mat",
            sample=config["samples"].keys()),

        expand("results/modelProcessing/relaxed/{sample}/{sample}_relaxed_preprocessed.mat",
            sample=config["samples"].keys()),

        expand("results/modelProcessing/relaxed_spontaneous/{sample}/{sample}_relaxed_spontaneous_preprocessed.mat",
            sample=config["samples"].keys()),

        # ───────────────────────────────────────────────
        # PREPROCESSED MODELS METRICS
        # ───────────────────────────────────────────────
        "results/modelProcessing/summary/draft_metrics.csv",
        "results/modelProcessing/summary/draft_spontaneous_metrics.csv",
        "results/modelProcessing/summary/relaxed_metrics.csv",
        "results/modelProcessing/summary/relaxed_spontaneous_metrics.csv",

        # ───────────────────────────────────────────────
        # PREPROCESSED MODELS STATISTICS
        # ───────────────────────────────────────────────
        "results/modelProcessing/summary/draft_statistics.md",
        "results/modelProcessing/summary/draft_spontaneous_statistics.md",
        "results/modelProcessing/summary/relaxed_statistics.md",
        "results/modelProcessing/summary/relaxed_spontaneous_statistics.md",

        
